<app-layout>

  <main class="home" [class.no-auth]="!auth.hasValidSession()">


    <ng-container *ngIf="auth.hasValidSession(); else noAuth">
      <div class="page-container">
        <h1>Bienvenido a ShowMeShows</h1>


        <div class="carousel" *ngIf="series.length > 0">
          <div class="slides-wrapper">
            <div class="slide" *ngFor="let serie of series | slice:0:3; let i = index"
              [class.active]="i === currentSlide">
              <img class="hero-bg" [src]="'https://image.tmdb.org/t/p/original' + serie.backdrop_path"
                alt="{{ serie.name }}">
              <div class="hero-info" *ngIf="i === currentSlide">
                <h2>{{ serie.name }}</h2>
                <p>{{ serie.overview }}</p>
                <button [routerLink]="['/serie', serie.id]" class="btn-primary">Ver detalles</button>
              </div>
            </div>
          </div>

        </div>

        <!-- ================================
          SECCIONES PARA USUARIO LOGUEADO
          ================================ -->


        <section class="home-section">
          <div class="section-header">
            <h2>En Tendencia</h2>
          </div>

          <div class="scroll-wrapper">
            <button class="btn-arrow left" (click)="scrollLeft()" title="Anterior">
              <svg viewBox="0 0 24 24" class="icon">
                <polyline points="15 18 9 12 15 6"></polyline>
              </svg>
            </button>
            <div class="scroll-row" #scrollContainer>
              <div class="serie-card" *ngFor="let t of tendencias" [routerLink]="['/serie', t.id]">
                <div class="serie-img-container">
                  <img [src]="'https://image.tmdb.org/t/p/w300' + t.poster_path" [alt]="t.name" />
                </div>
                <div class="serie-info">
                  <h3 class="serie-title">{{ t.name }}</h3>
                  <div class="serie-meta">
                    <span class="serie-year" *ngIf="t.first_air_date">{{ t.first_air_date | date:'yyyy' }}</span>
                    <span class="serie-rating">‚≠ê {{ t.vote_average | number:'1.1-1' }}</span>
                  </div>
                </div>
              </div>
            </div>
            <button class="btn-arrow right" (click)="scrollRight()" title="Siguiente">
              <svg viewBox="0 0 24 24" class="icon">
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </button>
          </div>
        </section>



        <!-- POPULAR EN SHOWMESHOWS -->
        <section class="home-section">
          <div class="section-header">
            <h2>Popular en ShowMeShows</h2>
          </div>

          <div class="scroll-wrapper">
            <button class="btn-arrow left" (click)="scrollHorizontal('populares', 'left')" title="Anterior">
              <svg viewBox="0 0 24 24" class="icon">
                <polyline points="15 18 9 12 15 6"></polyline>
              </svg>
            </button>

            <div class="scroll-row" #scrollPopulares>
              <div class="serie-card" *ngFor="let p of populares" [routerLink]="['/serie', p.id]">
                <div class="serie-img-container">
                  <img [src]="'https://image.tmdb.org/t/p/w300' + p.poster_path" [alt]="p.name">
                </div>
                <div class="serie-info">
                  <h3 class="serie-title">{{ p.name }}</h3>
                  <div class="serie-meta">
                    <span class="serie-year" *ngIf="p.first_air_date">{{ p.first_air_date | date:'yyyy' }}</span>
                    <span class="serie-rating">‚≠ê {{ p.vote_average | number:'1.1-1' }}</span>
                  </div>
                </div>
              </div>
            </div>

            <button class="btn-arrow right" (click)="scrollHorizontal('populares', 'right')" title="Siguiente">
              <svg viewBox="0 0 24 24" class="icon">
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </button>
          </div>
        </section>



        <!-- ‚≠ê DESCUBRIR SERIES -->
        <section class="home-section">
          <div class="section-header">
            <h2>üß≠ Descubrir nuevas series</h2>
            <button routerLink="/descubre" class="ver-mas-btn">Ver m√°s</button>
          </div>

          <div class="scroll-wrapper">
            <button class="btn-arrow left" (click)="scrollHorizontal('descubre', 'left')" title="Anterior">
              <svg viewBox="0 0 24 24" class="icon">
                <polyline points="15 18 9 12 15 6"></polyline>
              </svg>
            </button>
            <div class="scroll-row" #scrollDescubre>
              <div class="serie-card" *ngFor="let d of descubrirSeries" [routerLink]="['/serie', d.id]">
                <div class="serie-img-container">
                  <img [src]="'https://image.tmdb.org/t/p/w300' + d.poster_path" [alt]="d.name">
                </div>
                <div class="serie-info">
                  <h3 class="serie-title">{{ d.name }}</h3>
                  <div class="serie-meta">
                    <span class="serie-year" *ngIf="d.first_air_date">{{ d.first_air_date | date:'yyyy' }}</span>
                    <span class="serie-rating">‚≠ê {{ d.vote_average | number:'1.1-1' }}</span>
                  </div>
                </div>
              </div>
            </div>

            <button class="btn-arrow right" (click)="scrollHorizontal('descubre', 'right')" title="Siguiente">
              <svg viewBox="0 0 24 24" class="icon">
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </button>
          </div>
        </section>


        <!-- ‚≠ê √öLTIMAS RESE√ëAS -->
        <section class="home-section">
          <div class="section-header">
            <h2>üìù √öltimas rese√±as</h2>
          </div>

          <div class="reviews-row">
            <div class="review-card" *ngFor="let r of ultimasOpiniones">

              <!-- Perfil del usuario -->
              <div class="review-user" (click)="irPerfil(r.idUsuario?.username)" style="cursor: pointer;">
                <img [src]="r.idUsuario?.fotoPerfil || 'recursos/fotoPerfil.jpg'" class="avatar" />
                <span class="username">{{ r.idUsuario?.username }}</span>
              </div>

              <!-- Opini√≥n -->
              <p class="review-text">"{{ r.opinion }}"</p>

              <!-- Serie -->
              <span class="review-serie" [routerLink]="['/serie', r.idSerie]"
                style="cursor: pointer; text-decoration: none;">
                {{ r.nombreSerie }}
              </span>

            </div>
          </div>
        </section>


        <!-- ‚≠ê USUARIO CON M√ÅS RESE√ëAS -->
        <section class="home-section">
          <div class="section-header">
            <h2>üèÜ Usuarios con m√°s rese√±as</h2>
          </div>

          <div class="top-users-row">
            <div *ngFor="let u of topUsuarios" class="top-user-card"
            (click)="irPerfil(u.username)" style="cursor: pointer;">

              <img [src]="u.fotoPerfil || 'recursos/fotoPerfil.jpg'" class="avatar big" />

              <div class="top-user-info">
                <h3>{{ u.username }}</h3>
                <p>{{ u.totalOpiniones }} rese√±as publicadas</p>
              </div>
            </div>
          </div>
        </section>


        <!-- ‚≠ê LISTAS P√öBLICAS CON M√ÅS LIKES -->
        <section class="home-section">
          <div class="section-header">
            <h2>üìö Listas p√∫blicas con m√°s likes</h2>
            <button routerLink="/listas-publicas" class="ver-mas-btn">Ver m√°s</button>
          </div>

          <div class="listas-grid-home">
            <div class="lista-publica-card" *ngFor="let l of [1,2,3,4]">
              <h4>Nombre de la lista</h4>
              <p class="likes">‚ù§Ô∏è 120 likes</p>
            </div>
          </div>
        </section>


      </div>

      <!-- <div class="series-list">
        <div *ngFor="let serie of series" class="serie-card" [routerLink]="['/serie', serie.id]">
          <img [src]="'https://image.tmdb.org/t/p/w300' + serie.poster_path" alt="{{ serie.name }}">

          <div class="serie-info">
            <h3 class="serie-title">{{ serie.name }}</h3>

            <div class="serie-meta">
              <span class="serie-year">{{ serie.first_air_date | date:'yyyy' }}</span>

              <div class="serie-rating">
                <span class="stars">‚≠ê</span>
                <span class="rating-number">{{ serie.vote_average | number:'1.1-1' }}</span>
              </div>
            </div>
          </div>
        </div>
      </div> -->

      <!-- <div *ngIf="loading" class="loading">
        <p>Cargando m√°s series...</p>
      </div> -->
    </ng-container>

    <ng-template #noAuth>
      <div class="welcome-logo">
        <img src="recursos/Logo.png" alt="ShowMeShows Logo">
      </div>
      <section class="welcome-container">

        <div class="hero">
          <h2>Descubre, sigue y comparte tus series favoritas</h2>
          <p>Explora miles de series, guarda tu progreso y conecta con otros fans.</p>

          <div class="cta-buttons">
            <button routerLink="/registro" class="btn-primary">Crear cuenta</button>
            <button routerLink="/login" class="btn-secondary">Iniciar sesi√≥n</button>
          </div>
        </div>

        <div class="features">
          <div class="feature">
            <i class="icon">üì∫</i>
            <h3>Explora series</h3>
            <p>Informaci√≥n actualizada, tr√°ilers y recomendaciones.</p>
          </div>

          <div class="feature">
            <i class="icon">‚≠ê</i>
            <h3>Guarda tu progreso</h3>
            <p>Lleva un registro de episodios y temporadas vistas.</p>
          </div>

          <div class="feature">
            <i class="icon">üí¨</i>
            <h3>Comparte opiniones</h3>
            <p>Publica rese√±as y descubre lo que opina la comunidad.</p>
          </div>

          <div class="feature">
            <i class="icon">üß≠</i>
            <h3>Crea listas</h3>
            <p>Organiza tus series favoritas con listas personalizadas.</p>
          </div>
        </div>

        <div class="popular-preview">
          <h3>Lo m√°s visto esta semana</h3>
          <div class="preview-grid">
            <div *ngFor="let serie of series" class="preview-card">
              <img [src]="'https://image.tmdb.org/t/p/w300' + serie.poster_path">
            </div>
          </div>
        </div>

        <!-- <div class="final-cta">
          <p>√önete gratis y empieza a descubrir tu pr√≥xima serie favorita</p>
          <button routerLink="/register" class="btn-primary">Comenzar</button>
        </div> -->

      </section>
    </ng-template>
  </main>

</app-layout>