<app-layout>
  <main *ngIf="serie" class="serie-info text-white">
    <div class="serie-background"
      [style.background-image]="'url(https://image.tmdb.org/t/p/original' + serie.backdrop_path + ')'"></div>
    <div class="overlay-gradient"></div>

    <div class="serie-content">
      <div class="poster-container">
        <img [src]="'https://image.tmdb.org/t/p/w500' + serie.poster_path" alt="{{ serie.name }}"
          class="poster rounded-4 shadow-lg" />
      </div>

      <div class="info-container">
        <h1 class="fw-bold text-primary mb-3">{{ serie.name }}</h1>
        <p class="lead text-light mb-4">
          <strong>Sinopsis:</strong> {{ serie.overview }}
        </p>

        <p><strong>Fecha de estreno:</strong> {{ serie.first_air_date }}</p>
        <p><strong>Puntuación:</strong> <span class="text-warning">{{ serie.vote_average }} ⭐</span></p>

        <div class="mt-4 d-flex gap-3 flex-wrap" *ngIf="auth.hasValidSession()">
          <button class="btn btn-outline-light">
            <i class="bi bi-play-circle"></i> Ver Tráiler
          </button>
          <button class="btn" [class.btn-warning]="!isFavorite" [class.btn-danger]="isFavorite"
            (click)="toggleFavorite()">
            <i class="bi" [ngClass]="isFavorite ? 'bi-star-fill' : 'bi-star'"></i>
            {{ isFavorite ? 'Quitar de Favoritos' : 'Agregar a Favoritos' }}
          </button>

          <button class="btn" [class.btn-success]="!isFollowing" [class.btn-danger]="isFollowing"
            (click)="toggleSeguimiento()">
            <i class="bi" [ngClass]="isFollowing ? 'bi-check-circle-fill' : 'bi-plus-circle'"></i>
            {{ isFollowing ? 'Dejar de Seguir' : 'Seguir Serie' }}
          </button>

          <button class="btn btn-warning text-dark" (click)="abrirModalListas()">
            <i class="bi bi-star-fill"></i> Agregar a Lista
          </button>
        </div>

        <p *ngIf="!auth.hasValidSession()" class="text-light mt-3">
          Inicia sesión para interactuar con tus favoritos y listas.
        </p>
      </div>
    </div>
  </main>

  <div class="modal-overlay" *ngIf="mostrarModalListas" (click)="cerrarModalListas()"></div>

  <div class="modal-selector" *ngIf="mostrarModalListas">
    <h4>Agregar "{{ serie.name }}" a una lista</h4>

    <ng-container *ngIf="listasUsuarioConEstado.length > 0; else sinListas">
      <div class="listas-grid">
        <div *ngFor="let lista of listasUsuarioConEstado" class="lista-item"
          [ngClass]="{ 'contiene-serie': lista.contieneSerie }"
          (click)="!lista.contieneSerie && agregarSerieALista(lista._id)">
          <i class="bi bi-collection"></i>
          <span>{{ lista.nombre }}</span>
          <span *ngIf="lista.contieneSerie" class="badge-agregada">Ya agregada</span>
        </div>
      </div>
    </ng-container>

    <ng-template #sinListas>
      <p class="sin-listas">No tienes listas creadas aún.</p>
    </ng-template>

    <div class="acciones-modal">
      <button (click)="cerrarModalListas()" class="cancelar">Cancelar</button>
    </div>
  </div>

</app-layout>